@echo off

:: Check if Python is installed
python --version >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo Python is not installed. Installing now...
    winget install -e --id Python.Python.3 -h
    if %ERRORLEVEL% NEQ 0 (
        echo Failed to install Python. Please check winget setup.
        pause
        exit /b
    )
)

:: Verify Python installation
python --version
if %ERRORLEVEL% NEQ 0 (
    echo Python installation verification failed. Exiting...
    pause
    exit /b
)

:: Install required libraries
echo Installing required Python libraries...
python -m pip install --upgrade pip
python -m pip install faker selenium plyer
if %ERRORLEVEL% NEQ 0 (
    echo Failed to install Python libraries. Exiting...
    pause
    exit /b
)

:: Define the path to the desktop
set "desktop_path=%USERPROFILE%\Desktop\geckodriver"

:: Download and extract Geckodriver
echo Downloading Geckodriver...
if not exist "%desktop_path%" (
    set "geckodriver_url=https://github.com/mozilla/geckodriver/releases/latest/download/geckodriver-v0.35.0-win64.zip"
    set "zip_path=%desktop_path%\geckodriver.zip"
    set "extract_dir=%desktop_path%\geckodriver"

    echo Downloading Geckodriver zip...
    curl -L -o %zip_path% %geckodriver_url%
    if %ERRORLEVEL% NEQ 0 (
        echo Failed to download Geckodriver. Exiting...
        pause
        exit /b
    )

    echo Extracting Geckodriver...
    mkdir %extract_dir%
    powershell -Command "Expand-Archive -Path %zip_path% -DestinationPath %extract_dir%"
    if %ERRORLEVEL% NEQ 0 (
        echo Failed to extract Geckodriver. Exiting...
        pause
        exit /b
    )

    echo Geckodriver extracted successfully.
) else (
    echo Geckodriver already exists on the desktop.
)

:: Move Geckodriver to the desktop path
move /Y %extract_dir%\geckodriver.exe "%desktop_path%\geckodriver.exe"
if %ERRORLEVEL% NEQ 0 (
    echo Failed to move Geckodriver. Exiting...
    pause
    exit /b
)

:: Run the Python script
echo Running the Python script...
python nn.py
if %ERRORLEVEL% NEQ 0 (
    echo The script encountered an error. Exiting...
    pause
    exit /b
)

pause
